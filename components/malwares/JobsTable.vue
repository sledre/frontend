<template>
  <b-table :items="jobs" :fields="fields">
    <template #cell(creation_time)="row">
      {{ $moment(row.item.creation_time).format('LLL') }}
    </template>

    <template #cell(job_type)="row">
      {{ row.item.job_type }}s
    </template>

    <template #cell(job_time)="row">
      {{ row.item.job_time }}
    </template>

    <template #cell(download)="row">
      <b-btn
        :disabled="row.item.state !== 'DONE'"
        @click="downloadResults(row.item.id)"
      >
        Download Results
      </b-btn>
    </template>

    <template #cell(delete)="row">
      <b-btn
        :disabled="row.item.state !== 'DONE'"
        @click="deleteJob(row.item.id)"
        variant="danger"
      >
        Delete Job
      </b-btn>

    </template>
  </b-table>
</template>

<script>

export default {
  name: 'JobsTable',
  props: {
    jobs: { type: Array, default: () => { return [] } }
  },
  data () {
    return {
      fields: [
        {
          key: 'creation_time',
          label: 'Job created on',
          sortable: true,
          class: 'text-center'
        },
        {
          key: 'job_type',
          label: 'Job Type',
          sortable: true,
          class: 'text-center'
        },
        {
          key: 'job_time',
          label: 'Job Time',
          sortable: true,
          class: 'text-center'
        },
        {
          key: 'download',
          label: 'Download Results',
          class: 'text-center'
        },
        {
          key: 'delete',
          label: 'Delete Job',
          class: 'text-center'
        }
      ]
    }
  },
  methods: {
    downloadResults (id) {
      window.open(`/api/jobs/${id}/download_results/`)
    },
    deleteJob (id) {
      this.$api.malwaress.delete(id)
    }
  }
}
</script>

<style lang="scss" scoped>
</style>
